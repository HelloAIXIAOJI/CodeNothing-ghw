// CodeNothing v0.7.7 å¾ªç¯ä¼˜åŒ–ç­–ç•¥æµ‹è¯•
using lib <io>;

fn test_loop_unrolling(): int {
    print("ğŸ”§ æµ‹è¯•å¾ªç¯å±•å¼€ä¼˜åŒ–");
    
    sum : int = 0;
    
    // ç®€å•å¾ªç¯ï¼Œé€‚åˆå±•å¼€
    for (i : 1..20) {
        sum = sum + i;
    };
    
    print("å¾ªç¯å±•å¼€æµ‹è¯•ç»“æœ: " + sum);
    return sum;
};

fn test_strength_reduction(): int {
    print("ğŸ”§ æµ‹è¯•å¼ºåº¦å‰Šå‡ä¼˜åŒ–");
    
    result : int = 0;
    
    // åŒ…å«ä¹˜æ³•çš„å¾ªç¯ï¼Œé€‚åˆå¼ºåº¦å‰Šå‡
    for (i : 1..50) {
        result = result + i * 3;  // ä¹˜æ³•åº”è¯¥è¢«ä¼˜åŒ–ä¸ºåŠ æ³•
    };
    
    print("å¼ºåº¦å‰Šå‡æµ‹è¯•ç»“æœ: " + result);
    return result;
};

fn test_invariant_hoisting(): int {
    print("ğŸ”§ æµ‹è¯•å¾ªç¯ä¸å˜é‡æå‡ä¼˜åŒ–");
    
    sum : int = 0;
    constant_value : int = 42;  // å¾ªç¯ä¸å˜é‡
    
    for (i : 1..30) {
        sum = sum + constant_value;  // ä¸å˜é‡åº”è¯¥è¢«æå‡
    };
    
    print("ä¸å˜é‡æå‡æµ‹è¯•ç»“æœ: " + sum);
    return sum;
};

fn test_complex_loop(): int {
    print("ğŸ”§ æµ‹è¯•å¤æ‚å¾ªç¯ï¼ˆä¸é€‚åˆæŸäº›ä¼˜åŒ–ï¼‰");
    
    total : int = 0;
    
    // å¤æ‚å¾ªç¯ï¼ŒåŒ…å«æ¡ä»¶åˆ†æ”¯
    for (i : 1..25) {
        if (i % 2 == 0) {
            total = total + i * 2;
        } else {
            total = total + i;
        };
    };
    
    print("å¤æ‚å¾ªç¯æµ‹è¯•ç»“æœ: " + total);
    return total;
};

fn test_nested_loops(): int {
    print("ğŸ”§ æµ‹è¯•åµŒå¥—å¾ªç¯ï¼ˆä¸é€‚åˆå±•å¼€ï¼‰");
    
    result : int = 0;
    
    // åµŒå¥—å¾ªç¯ï¼Œä¸é€‚åˆå±•å¼€
    for (i : 1..8) {
        for (j : 1..8) {
            result = result + i * j;
        };
    };
    
    print("åµŒå¥—å¾ªç¯æµ‹è¯•ç»“æœ: " + result);
    return result;
};

fn test_multiplication_heavy_loop(): int {
    print("ğŸ”§ æµ‹è¯•ä¹˜æ³•å¯†é›†å¾ªç¯ï¼ˆé€‚åˆå¼ºåº¦å‰Šå‡ï¼‰");
    
    value : int = 0;
    
    for (i : 1..40) {
        value = value + i * 5 + i * 2;  // å¤šä¸ªä¹˜æ³•æ“ä½œ
    };
    
    print("ä¹˜æ³•å¯†é›†å¾ªç¯æµ‹è¯•ç»“æœ: " + value);
    return value;
};

fn main(): int {
    print("=== CodeNothing v0.7.7 å¾ªç¯ä¼˜åŒ–ç­–ç•¥æµ‹è¯• ===");
    print("");
    
    result1 : int = test_loop_unrolling();
    result2 : int = test_strength_reduction();
    result3 : int = test_invariant_hoisting();
    result4 : int = test_complex_loop();
    result5 : int = test_nested_loops();
    result6 : int = test_multiplication_heavy_loop();
    
    total : int = result1 + result2 + result3 + result4 + result5 + result6;
    
    print("");
    print("=== ä¼˜åŒ–ç­–ç•¥æµ‹è¯•å®Œæˆ ===");
    print("æ€»è®¡ç»“æœ: " + total);
    print("ğŸ‰ å¾ªç¯ä¼˜åŒ–ç­–ç•¥éªŒè¯å®Œæˆï¼");
    print("è¯·æŸ¥çœ‹JITè°ƒè¯•è¾“å‡ºä»¥éªŒè¯ä¼˜åŒ–ç­–ç•¥çš„åº”ç”¨ã€‚");
    
    return total;
};
