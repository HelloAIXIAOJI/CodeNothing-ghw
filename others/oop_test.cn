// CodeNothing OOPç»¼åˆæµ‹è¯•ç¨‹åº
// æµ‹è¯•ç±»å®šä¹‰ã€ç»§æ‰¿ã€å¤šæ€ã€å°è£…ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§

using lib <io>;
using ns std;

// åŸºç¡€æŠ½è±¡ç±» - åŠ¨ç‰©
abstract class Animal {
    protected name : string;
    protected age : int;
    private id : int;
    
    // æ„é€ å‡½æ•°
    constructor(name : string, age : int) {
        this.name = name;
        this.age = age;
        this.id = generate_id();
        std::println("åˆ›å»ºåŠ¨ç‰©: " + name);
    };
    
    // æŠ½è±¡æ–¹æ³• - å­ç±»å¿…é¡»å®ç°
    abstract fn make_sound() : string;
    
    // è™šæ–¹æ³• - å¯ä»¥è¢«é‡å†™
    virtual fn move() : string {
        return this.name + " æ­£åœ¨ç§»åŠ¨";
    };
    
    // æ™®é€šæ–¹æ³•
    fn get_info() : string {
        return "åå­—: " + this.name + ", å¹´é¾„: " + this.age;
    };
    
    // é™æ€æ–¹æ³•
    static fn get_species_count() : int {
        return 42; // æ¨¡æ‹Ÿç‰©ç§æ•°é‡
    };
    
    // ç§æœ‰æ–¹æ³•
    private fn generate_id() : int {
        return 12345; // ç®€åŒ–çš„IDç”Ÿæˆ
    };
};

// å…·ä½“ç±» - ç‹—
class Dog extends Animal {
    private breed : string;
    private is_trained : bool;

    // æ„é€ å‡½æ•°
    constructor(name : string, age : int, breed : string) {
        this.name = name;
        this.age = age;
        this.breed = breed;
        this.is_trained = false;
        std::println("åˆ›å»ºç‹—: " + name + " (" + breed + ")");
    };
    
    // å®ç°æŠ½è±¡æ–¹æ³•
    override fn make_sound() : string {
        return "æ±ªæ±ª! æˆ‘æ˜¯ " + this.name;
    };
    
    // é‡å†™è™šæ–¹æ³•
    override fn move() : string {
        return this.name + " æ­£åœ¨å¥”è·‘";
    };
    
    // ç‹—ç‰¹æœ‰çš„æ–¹æ³•
    fn train() : void {
        this.is_trained = true;
        std::println(this.name + " å·²ç»è®­ç»ƒå®Œæˆ!");
        return;
    };
    
    fn fetch(item : string) : string {
        if (this.is_trained) {
            return this.name + " æ¡å›äº† " + item;
        } else {
            return this.name + " è¿˜æ²¡æœ‰è®­ç»ƒï¼Œä¸ä¼šæ¡ä¸œè¥¿";
        };
    };
    
    // è·å–å“ç§ä¿¡æ¯
    fn get_breed() : string {
        return this.breed;
    };
};

// å…·ä½“ç±» - çŒ«
class Cat extends Animal {
    private indoor : bool;
    private lives_remaining : int;

    // æ„é€ å‡½æ•°
    constructor(name : string, age : int, indoor : bool) {
        this.name = name;
        this.age = age;
        this.indoor = indoor;
        this.lives_remaining = 9;
        std::println("åˆ›å»ºçŒ«: " + name + (indoor ? " (å®¤å†…)" : " (å®¤å¤–)"));
    };
    
    // å®ç°æŠ½è±¡æ–¹æ³•
    override fn make_sound() : string {
        return "å–µå–µ~ æˆ‘æ˜¯ " + this.name;
    };
    
    // é‡å†™è™šæ–¹æ³•
    override fn move() : string {
        return this.name + " æ­£åœ¨ä¼˜é›…åœ°è¸±æ­¥";
    };
    
    // çŒ«ç‰¹æœ‰çš„æ–¹æ³•
    fn climb() : string {
        return this.name + " çˆ¬åˆ°äº†é«˜å¤„";
    };
    
    fn use_life() : void {
        if (this.lives_remaining > 0) {
            this.lives_remaining = this.lives_remaining - 1;
            std::println(this.name + " ç”¨æ‰äº†ä¸€æ¡å‘½ï¼Œè¿˜å‰© " + this.lives_remaining + " æ¡");
        };
        return;
    };
    
    fn get_lives() : int {
        return this.lives_remaining;
    };
};

// æ¥å£å®šä¹‰ - å¯è®­ç»ƒçš„
interface Trainable {
    fn train() : void;
    fn is_trained() : bool;
};

// å®ç°æ¥å£çš„ç±» - è­¦çŠ¬
class PoliceDog extends Dog implements Trainable {
    private badge_number : string;
    private specialized_training : bool;

    constructor(name : string, age : int, breed : string, badge : string) {
        this.name = name;
        this.age = age;
        this.breed = breed;
        this.is_trained = false;
        this.badge_number = badge;
        this.specialized_training = false;
        std::println("åˆ›å»ºè­¦çŠ¬: " + name + " å¾½ç« å·: " + badge);
    };
    
    // å®ç°æ¥å£æ–¹æ³•
    override fn train() : void {
        // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        super.train();
        this.specialized_training = true;
        std::println(this.badge_number + " å·è­¦çŠ¬ä¸“ä¸šè®­ç»ƒå®Œæˆ!");
        return;
    };
    
    fn is_trained() : bool {
        return this.specialized_training;
    };
    
    // è­¦çŠ¬ç‰¹æœ‰æ–¹æ³•
    fn patrol() : string {
        if (this.specialized_training) {
            return "è­¦çŠ¬ " + this.name + " æ­£åœ¨å·¡é€»";
        } else {
            return "è­¦çŠ¬ " + this.name + " éœ€è¦å…ˆå®Œæˆè®­ç»ƒ";
        };
    };
    
    fn get_badge() : string {
        return this.badge_number;
    };
};

// å·¥å…·ç±» - åŠ¨ç‰©å›­ç®¡ç†
class Zoo {
    private animals : []Animal;
    private name : string;
    
    constructor(zoo_name : string) {
        this.name = zoo_name;
        this.animals = [];
        std::println("åˆ›å»ºåŠ¨ç‰©å›­: " + zoo_name);
    };
    
    fn add_animal(animal : Animal) : void {
        this.animals.push(animal);
        std::println("åŠ¨ç‰©å›­æ·»åŠ äº†æ–°åŠ¨ç‰©");
        return;
    };
    
    fn make_all_sounds() : void {
        std::println("=== " + this.name + " çš„åŠ¨ç‰©ä»¬åœ¨å« ===");
        foreach (animal in this.animals) {
            std::println(animal.make_sound());
        };
        return;
    };
    
    fn exercise_animals() : void {
        std::println("=== åŠ¨ç‰©ä»¬åœ¨è¿åŠ¨ ===");
        foreach (animal in this.animals) {
            std::println(animal.move());
        };
        return;
    };
    
    fn get_animal_count() : int {
        return this.animals.length();
    };
};

// ä¸»å‡½æ•° - æµ‹è¯•æ‰€æœ‰OOPç‰¹æ€§
fn main() : int {
    std::println("ğŸ¾ CodeNothing OOPç»¼åˆæµ‹è¯•å¼€å§‹");
    std::println("=====================================");
    
    // 1. åŸºæœ¬ç±»å®ä¾‹åŒ–å’Œæ–¹æ³•è°ƒç”¨
    std::println("1. åˆ›å»ºåŠ¨ç‰©å®ä¾‹");
    dog1 : Dog = new Dog("æ—ºè´¢", 3, "é‡‘æ¯›");
    cat1 : Cat = new Cat("å’ªå’ª", 2, true);
    police_dog : PoliceDog = new PoliceDog("é›·å…‹æ–¯", 4, "å¾·ç‰§", "K9-001");
    
    std::println("");
    
    // 2. å¤šæ€æµ‹è¯•
    std::println("2. å¤šæ€æµ‹è¯• - åŠ¨ç‰©å«å£°");
    std::println(dog1.make_sound());
    std::println(cat1.make_sound());
    std::println(police_dog.make_sound());
    std::println("");
    
    // 3. æ–¹æ³•é‡å†™æµ‹è¯•
    std::println("3. æ–¹æ³•é‡å†™æµ‹è¯• - ç§»åŠ¨æ–¹å¼");
    std::println(dog1.move());
    std::println(cat1.move());
    std::println(police_dog.move());
    std::println("");
    
    // 4. ç‰¹æœ‰æ–¹æ³•æµ‹è¯•
    std::println("4. ç±»ç‰¹æœ‰æ–¹æ³•æµ‹è¯•");
    dog1.train();
    std::println(dog1.fetch("çƒ"));
    std::println(cat1.climb());
    cat1.use_life();
    std::println("çŒ«å’ªå‰©ä½™ç”Ÿå‘½: " + cat1.get_lives());
    std::println("");
    
    // 5. æ¥å£å’Œç»§æ‰¿æµ‹è¯•
    std::println("5. æ¥å£å’Œç»§æ‰¿æµ‹è¯•");
    police_dog.train();
    std::println("è­¦çŠ¬è®­ç»ƒçŠ¶æ€: " + police_dog.is_trained());
    std::println(police_dog.patrol());
    std::println("è­¦çŠ¬å¾½ç« : " + police_dog.get_badge());
    std::println("");
    
    // 6. é™æ€æ–¹æ³•æµ‹è¯•
    std::println("6. é™æ€æ–¹æ³•æµ‹è¯•");
    species_count : int = Animal::get_species_count();
    std::println("åŠ¨ç‰©ç‰©ç§æ€»æ•°: " + species_count);
    std::println("");
    
    // 7. ç»„åˆå’Œèšåˆæµ‹è¯•
    std::println("7. åŠ¨ç‰©å›­ç®¡ç†æµ‹è¯•");
    zoo : Zoo = new Zoo("CodeNothingåŠ¨ç‰©å›­");
    zoo.add_animal(dog1);
    zoo.add_animal(cat1);
    zoo.add_animal(police_dog);
    
    std::println("åŠ¨ç‰©å›­åŠ¨ç‰©æ•°é‡: " + zoo.get_animal_count());
    zoo.make_all_sounds();
    zoo.exercise_animals();
    std::println("");
    
    std::println("ğŸ‰ OOPæµ‹è¯•å®Œæˆ!");
    std::println("=====================================");
    
    // 8. å°è£…æµ‹è¯• - è®¿é—®æ§åˆ¶
    std::println("8. å°è£…æµ‹è¯• - è®¿é—®æ§åˆ¶");
    std::println("ç‹—çš„ä¿¡æ¯: " + dog1.get_info()); // publicæ–¹æ³•
    std::println("ç‹—çš„å“ç§: " + dog1.get_breed()); // publicæ–¹æ³•
    // dog1.name; // è¿™ä¼šæŠ¥é”™ï¼Œå› ä¸ºnameæ˜¯protected
    // dog1.id;   // è¿™ä¼šæŠ¥é”™ï¼Œå› ä¸ºidæ˜¯private
    std::println("");

    // 9. ç±»å‹è½¬æ¢å’Œinstanceofæµ‹è¯•
    std::println("9. ç±»å‹æ£€æŸ¥æµ‹è¯•");
    test_animal_type(dog1);
    test_animal_type(cat1);
    test_animal_type(police_dog);
    std::println("");

    // 10. è®¾è®¡æ¨¡å¼æµ‹è¯•
    std::println("10. è®¾è®¡æ¨¡å¼æµ‹è¯•");

    // å•ä¾‹æ¨¡å¼æµ‹è¯•
    std::println("--- å•ä¾‹æ¨¡å¼æµ‹è¯• ---");
    hospital1 : AnimalHospital = AnimalHospital::get_instance();
    hospital2 : AnimalHospital = AnimalHospital::get_instance();
    // hospital1 å’Œ hospital2 åº”è¯¥æ˜¯åŒä¸€ä¸ªå®ä¾‹

    std::println(hospital1.treat_animal(dog1));
    std::println(hospital2.treat_animal(cat1));
    std::println("åŒ»é™¢æ‚£è€…æ€»æ•°: " + hospital1.get_patient_count());

    // å·¥å‚æ¨¡å¼æµ‹è¯•
    std::println("--- å·¥å‚æ¨¡å¼æµ‹è¯• ---");
    dog_factory : DogFactory = new DogFactory("æ‹‰å¸ƒæ‹‰å¤š");
    cat_factory : CatFactory = new CatFactory(true);

    factory_dog : Animal = dog_factory.create_and_register("å·¥å‚ç‹—", 2);
    factory_cat : Animal = cat_factory.create_and_register("å·¥å‚çŒ«", 1);

    std::println("å·¥å‚åˆ›å»ºçš„åŠ¨ç‰©å«å£°:");
    std::println(factory_dog.make_sound());
    std::println(factory_cat.make_sound());

    // è§‚å¯Ÿè€…æ¨¡å¼æµ‹è¯•
    std::println("--- è§‚å¯Ÿè€…æ¨¡å¼æµ‹è¯• ---");
    logger : AnimalBehaviorLogger = new AnimalBehaviorLogger();

    // æ¨¡æ‹ŸåŠ¨ç‰©è¡Œä¸ºå¹¶è®°å½•
    logger.on_animal_action(dog1, "æ‘‡å°¾å·´");
    logger.on_animal_action(cat1, "æ‰“å‘¼å™œ");
    logger.on_animal_action(police_dog, "æ‰§è¡Œä»»åŠ¡");

    std::println("è¡Œä¸ºæ—¥å¿—æ€»æ•°: " + logger.get_log_count());
    std::println("");

    return 0;
};

// è¾…åŠ©å‡½æ•° - æµ‹è¯•åŠ¨ç‰©ç±»å‹
fn test_animal_type(animal : Animal) : void {
    std::println("æµ‹è¯•åŠ¨ç‰©: " + animal.get_info());
    std::println("å«å£°: " + animal.make_sound());
    std::println("ç§»åŠ¨: " + animal.move());
    std::println("---");
    return;
};

// ========== è®¾è®¡æ¨¡å¼ç¤ºä¾‹ ==========

// å•ä¾‹æ¨¡å¼ - åŠ¨ç‰©åŒ»é™¢
class AnimalHospital {
    private static instance : AnimalHospital;
    private name : string;
    private patient_count : int;

    // ç§æœ‰æ„é€ å‡½æ•°
    private constructor() {
        this.name = "CodeNothingåŠ¨ç‰©åŒ»é™¢";
        this.patient_count = 0;
    };

    // è·å–å•ä¾‹å®ä¾‹
    static fn get_instance() : AnimalHospital {
        if (AnimalHospital::instance == null) {
            AnimalHospital::instance = new AnimalHospital();
        };
        return AnimalHospital::instance;
    };

    fn treat_animal(animal : Animal) : string {
        this.patient_count = this.patient_count + 1;
        return "åœ¨" + this.name + "æ²»ç–—äº† " + animal.get_info() + " (ç¬¬" + this.patient_count + "ä½æ‚£è€…)";
    };

    fn get_patient_count() : int {
        return this.patient_count;
    };
};

// å·¥å‚æ¨¡å¼ - åŠ¨ç‰©å·¥å‚
abstract class AnimalFactory {
    abstract fn create_animal(name : string, age : int) : Animal;

    // æ¨¡æ¿æ–¹æ³•
    fn create_and_register(name : string, age : int) : Animal {
        animal : Animal = this.create_animal(name, age);
        std::println("åŠ¨ç‰©å·¥å‚æ³¨å†Œäº†æ–°åŠ¨ç‰©: " + animal.get_info());
        return animal;
    };
};

class DogFactory extends AnimalFactory {
    private default_breed : string;

    constructor(breed : string) {
        this.default_breed = breed;
    };

    override fn create_animal(name : string, age : int) : Animal {
        return new Dog(name, age, this.default_breed);
    };
};

class CatFactory extends AnimalFactory {
    private default_indoor : bool;

    constructor(indoor : bool) {
        this.default_indoor = indoor;
    };

    override fn create_animal(name : string, age : int) : Animal {
        return new Cat(name, age, this.default_indoor);
    };
};

// è§‚å¯Ÿè€…æ¨¡å¼ - åŠ¨ç‰©è¡Œä¸ºè§‚å¯Ÿ
interface AnimalObserver {
    fn on_animal_action(animal : Animal, action : string) : void;
};

class AnimalBehaviorLogger : AnimalObserver {
    private log_count : int;

    constructor() {
        this.log_count = 0;
    };

    fn on_animal_action(animal : Animal, action : string) : void {
        this.log_count = this.log_count + 1;
        std::println("[æ—¥å¿— #" + this.log_count + "] " + animal.get_info() + " æ‰§è¡Œäº†: " + action);
        return;
    };

    fn get_log_count() : int {
        return this.log_count;
    };
};
