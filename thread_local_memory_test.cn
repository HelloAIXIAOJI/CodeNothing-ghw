using lib <io>;
using ns std;

// ğŸš€ CodeNothing v0.6.11 çº¿ç¨‹æœ¬åœ°å†…å­˜æ± æ€§èƒ½æµ‹è¯•

fn main(): int {
    std::println("ğŸ§® çº¿ç¨‹æœ¬åœ°å†…å­˜æ± æ€§èƒ½æµ‹è¯•å¼€å§‹");

    // æµ‹è¯•1: åŸºç¡€çº¿ç¨‹æœ¬åœ°å†…å­˜åˆ†é…
    std::println("æµ‹è¯•1: åŸºç¡€çº¿ç¨‹æœ¬åœ°å†…å­˜åˆ†é…");
    test_basic_local_allocation();

    // æµ‹è¯•2: å¤§é‡å°å¯¹è±¡åˆ†é…
    std::println("æµ‹è¯•2: å¤§é‡å°å¯¹è±¡åˆ†é…");
    test_small_object_allocation();

    // æµ‹è¯•3: å†…å­˜æ± æ‰©å±•æµ‹è¯•
    std::println("æµ‹è¯•3: å†…å­˜æ± æ‰©å±•æµ‹è¯•");
    test_memory_pool_expansion();

    // æµ‹è¯•4: æ™ºèƒ½å†…å­˜åˆ†é…ç­–ç•¥
    std::println("æµ‹è¯•4: æ™ºèƒ½å†…å­˜åˆ†é…ç­–ç•¥");
    test_smart_allocation_strategy();

    // æµ‹è¯•5: æ€§èƒ½åŸºå‡†æµ‹è¯•
    std::println("æµ‹è¯•5: æ€§èƒ½åŸºå‡†æµ‹è¯•");
    test_performance_benchmark();

    std::println("ğŸ‰ çº¿ç¨‹æœ¬åœ°å†…å­˜æ± æµ‹è¯•å®Œæˆï¼");

    return 0;
};

fn test_basic_local_allocation(): int {
    std::println("  - åŸºç¡€åˆ†é…æµ‹è¯•");

    // åˆ†é…ä¸€äº›åŸºç¡€ç±»å‹
    i : int = 1;
    while (i <= 10) {
        temp_int : int = i * 100;
        temp_str : string = "test_object";
        temp_bool : bool = (i % 2 == 0);

        std::println("    åˆ†é…å¯¹è±¡å®Œæˆ");
        i = i + 1;
    };

    std::println("  âœ… åŸºç¡€åˆ†é…æµ‹è¯•å®Œæˆ");
    return 0;
};

fn test_small_object_allocation(): int {
    std::println("  - å°å¯¹è±¡å¤§é‡åˆ†é…æµ‹è¯•");

    total_allocated : int = 0;
    i : int = 1;
    while (i <= 100) {
        // åˆ†é…å°å¯¹è±¡
        small_int : int = i;
        small_float : float = 1.5;
        small_string : string = "obj_test";

        total_allocated = total_allocated + 3; // æ¯æ¬¡åˆ†é…3ä¸ªå¯¹è±¡

        if (i % 20 == 0) {
            std::println("    å·²åˆ†é…å°å¯¹è±¡");
        };

        i = i + 1;
    };

    std::println("  âœ… å°å¯¹è±¡åˆ†é…æµ‹è¯•å®Œæˆ");
    return total_allocated;
};

fn test_memory_pool_expansion(): int {
    std::println("  - å†…å­˜æ± æ‰©å±•æµ‹è¯•");

    // åˆ†é…å¤§é‡å¯¹è±¡ä»¥è§¦å‘æ± æ‰©å±•
    expansion_count : int = 0;
    i : int = 1;
    while (i <= 50) {
        // åˆ›å»ºè¾ƒå¤§çš„å­—ç¬¦ä¸²ä»¥å¿«é€Ÿæ¶ˆè€—å†…å­˜æ± 
        large_string : string = "large_object_with_extra_data_to_consume_memory_pool_space";
        array_data : array<int> = [1, 2, 3, 4, 5];

        expansion_count = expansion_count + 1;

        if (i % 10 == 0) {
            std::println("    æ‰©å±•æµ‹è¯•è¿›åº¦");
        };

        i = i + 1;
    };

    std::println("  âœ… å†…å­˜æ± æ‰©å±•æµ‹è¯•å®Œæˆ");
    return expansion_count;
};

fn test_smart_allocation_strategy(): int {
    std::println("  - æ™ºèƒ½åˆ†é…ç­–ç•¥æµ‹è¯•");

    strategy_tests : int = 0;

    // æµ‹è¯•ä¸åŒç±»å‹çš„æ™ºèƒ½åˆ†é…
    i : int = 1;
    while (i <= 20) {
        // å°å‹ä¸´æ—¶å€¼
        small_temp : int = i;

        // ä¸­ç­‰å¤§å°å­—ç¬¦ä¸²
        medium_string : string = "medium_size_string_for_testing_allocation_strategy";

        // å°æ•°ç»„
        small_array : array<int> = [1, 2, 3];

        strategy_tests = strategy_tests + 3;

        if (i % 5 == 0) {
            std::println("    æ™ºèƒ½åˆ†é…æµ‹è¯•è¿›è¡Œä¸­");
        };

        i = i + 1;
    };

    std::println("  âœ… æ™ºèƒ½åˆ†é…ç­–ç•¥æµ‹è¯•å®Œæˆ");
    return strategy_tests;
};

fn test_performance_benchmark(): int {
    std::println("  - æ€§èƒ½åŸºå‡†æµ‹è¯•");

    // é«˜é¢‘åˆ†é…æµ‹è¯•
    benchmark_iterations : int = 200;
    total_operations : int = 0;

    std::println("    å¼€å§‹é«˜é¢‘å†…å­˜æ“ä½œåŸºå‡†æµ‹è¯•...");

    i : int = 1;
    while (i <= benchmark_iterations) {
        // æ¨¡æ‹ŸçœŸå®åº”ç”¨åœºæ™¯çš„å†…å­˜æ“ä½œ
        temp_calc : int = i * i;
        temp_result : float = 3.14159;
        temp_message : string = "benchmark_result";

        // åµŒå¥—åˆ†é…
        j : int = 1;
        while (j <= 3) {
            nested_value : int = i * j;
            nested_string : string = "nested_value";
            j = j + 1;
            total_operations = total_operations + 2;
        };

        total_operations = total_operations + 3;

        if (i % 50 == 0) {
            std::println("    åŸºå‡†æµ‹è¯•è¿›åº¦");
        };

        i = i + 1;
    };

    std::println("  âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•å®Œæˆ");
    std::println("    æ€»è¿­ä»£æ¬¡æ•°å®Œæˆ");
    std::println("    æ€»å†…å­˜æ“ä½œæ•°å®Œæˆ");
    std::println("    å¹³å‡æ¯æ¬¡è¿­ä»£æ“ä½œæ•°å®Œæˆ");

    return total_operations;
};
