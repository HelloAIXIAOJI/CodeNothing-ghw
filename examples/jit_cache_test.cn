// CodeNothing v0.7.7 JITç¼–è¯‘ç¼“å­˜ç³»ç»Ÿæµ‹è¯•
using lib <io>;

fn test_cache_hit_simple_loop(): int {
    print("ğŸ—„ï¸ æµ‹è¯•ç®€å•å¾ªç¯ç¼“å­˜å‘½ä¸­");
    
    sum : int = 0;
    
    // ç¬¬ä¸€æ¬¡æ‰§è¡Œ - åº”è¯¥ç¼–è¯‘å¹¶ç¼“å­˜
    for (i : 1..50) {
        sum = sum + i;
    };
    
    print("ç¬¬ä¸€æ¬¡æ‰§è¡Œç»“æœ: " + sum);
    
    // ç¬¬äºŒæ¬¡æ‰§è¡Œç›¸åŒæ¨¡å¼ - åº”è¯¥å‘½ä¸­ç¼“å­˜
    sum2 : int = 0;
    for (j : 1..50) {
        sum2 = sum2 + j;
    };
    
    print("ç¬¬äºŒæ¬¡æ‰§è¡Œç»“æœ: " + sum2);
    return sum + sum2;
};

fn test_cache_hit_while_loop(): int {
    print("ğŸ—„ï¸ æµ‹è¯•Whileå¾ªç¯ç¼“å­˜å‘½ä¸­");
    
    result : int = 0;
    
    // ç¬¬ä¸€æ¬¡æ‰§è¡Œ - åº”è¯¥ç¼–è¯‘å¹¶ç¼“å­˜
    i : int = 0;
    while (i < 30) {
        result = result + i * 2;
        i = i + 1;
    };
    
    print("ç¬¬ä¸€æ¬¡Whileå¾ªç¯ç»“æœ: " + result);
    
    // ç¬¬äºŒæ¬¡æ‰§è¡Œç›¸åŒæ¨¡å¼ - åº”è¯¥å‘½ä¸­ç¼“å­˜
    result2 : int = 0;
    k : int = 0;
    while (k < 30) {
        result2 = result2 + k * 2;
        k = k + 1;
    };
    
    print("ç¬¬äºŒæ¬¡Whileå¾ªç¯ç»“æœ: " + result2);
    return result + result2;
};

fn test_cache_miss_different_complexity(): int {
    print("ğŸ—„ï¸ æµ‹è¯•ä¸åŒå¤æ‚åº¦å¾ªç¯ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰");
    
    // ç®€å•å¾ªç¯
    simple_sum : int = 0;
    for (i : 1..20) {
        simple_sum = simple_sum + i;
    };
    
    print("ç®€å•å¾ªç¯ç»“æœ: " + simple_sum);
    
    // å¤æ‚å¾ªç¯ - ä¸åŒçš„æ¨¡å¼ï¼Œä¸åº”è¯¥å‘½ä¸­ç¼“å­˜
    complex_sum : int = 0;
    for (j : 1..20) {
        if (j % 2 == 0) {
            complex_sum = complex_sum + j * 3;
        } else {
            complex_sum = complex_sum + j;
        };
    };
    
    print("å¤æ‚å¾ªç¯ç»“æœ: " + complex_sum);
    return simple_sum + complex_sum;
};

fn test_cache_with_optimization_strategies(): int {
    print("ğŸ—„ï¸ æµ‹è¯•å¸¦ä¼˜åŒ–ç­–ç•¥çš„ç¼“å­˜");
    
    // é€‚åˆå¼ºåº¦å‰Šå‡çš„å¾ªç¯
    strength_result : int = 0;
    for (i : 1..25) {
        strength_result = strength_result + i * 5;  // ä¹˜æ³•ä¼˜åŒ–
    };
    
    print("å¼ºåº¦å‰Šå‡å¾ªç¯ç»“æœ: " + strength_result);
    
    // ç›¸åŒæ¨¡å¼çš„å¾ªç¯ - åº”è¯¥å‘½ä¸­ç¼“å­˜
    strength_result2 : int = 0;
    for (j : 1..25) {
        strength_result2 = strength_result2 + j * 5;
    };
    
    print("ç¬¬äºŒæ¬¡å¼ºåº¦å‰Šå‡å¾ªç¯ç»“æœ: " + strength_result2);
    
    // é€‚åˆå¾ªç¯å±•å¼€çš„ç®€å•å¾ªç¯
    unroll_result : int = 0;
    for (k : 1..15) {
        unroll_result = unroll_result + k;
    };
    
    print("å¾ªç¯å±•å¼€æµ‹è¯•ç»“æœ: " + unroll_result);
    
    return strength_result + strength_result2 + unroll_result;
};

fn test_repeated_execution_for_cache_stats(): int {
    print("ğŸ—„ï¸ æµ‹è¯•é‡å¤æ‰§è¡Œä»¥éªŒè¯ç¼“å­˜ç»Ÿè®¡");
    
    total : int = 0;
    
    // é‡å¤æ‰§è¡Œç›¸åŒæ¨¡å¼çš„å¾ªç¯å¤šæ¬¡
    for (round : 1..5) {
        round_sum : int = 0;
        for (i : 1..10) {
            round_sum = round_sum + i;
        };
        total = total + round_sum;
        print("ç¬¬" + round + "è½®æ‰§è¡Œç»“æœ: " + round_sum);
    };
    
    print("æ€»è®¡ç»“æœ: " + total);
    return total;
};

fn main(): int {
    print("=== CodeNothing v0.7.7 JITç¼–è¯‘ç¼“å­˜ç³»ç»Ÿæµ‹è¯• ===");
    print("");
    
    result1 : int = test_cache_hit_simple_loop();
    print("");
    
    result2 : int = test_cache_hit_while_loop();
    print("");
    
    result3 : int = test_cache_miss_different_complexity();
    print("");
    
    result4 : int = test_cache_with_optimization_strategies();
    print("");
    
    result5 : int = test_repeated_execution_for_cache_stats();
    print("");
    
    total : int = result1 + result2 + result3 + result4 + result5;
    
    print("=== JITç¼“å­˜ç³»ç»Ÿæµ‹è¯•å®Œæˆ ===");
    print("æ€»è®¡ç»“æœ: " + total);
    print("ğŸ‰ JITç¼–è¯‘ç¼“å­˜ç³»ç»ŸéªŒè¯å®Œæˆï¼");
    print("è¯·æŸ¥çœ‹JITè°ƒè¯•è¾“å‡ºä»¥éªŒè¯ç¼“å­˜å‘½ä¸­å’Œç»Ÿè®¡ä¿¡æ¯ã€‚");
    
    return total;
};
