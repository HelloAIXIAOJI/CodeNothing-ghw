// CodeNothing v0.7.7 å¾ªç¯JITç¼–è¯‘å™¨æµ‹è¯•å¥—ä»¶
using lib <io>;

fn test_basic_for_loop_jit(): int {
    print("ğŸ”„ æµ‹è¯•åŸºç¡€Forå¾ªç¯JITç¼–è¯‘");
    
    sum : int = 0;
    for (i : 1..100) {
        sum = sum + i;
    };
    
    print("åŸºç¡€Forå¾ªç¯ç»“æœ: " + sum);
    return sum;
};

fn test_nested_for_loop_jit(): int {
    print("ğŸ”„ æµ‹è¯•åµŒå¥—Forå¾ªç¯JITç¼–è¯‘");
    
    total : int = 0;
    for (i : 1..10) {
        for (j : 1..10) {
            total = total + i * j;
        };
    };
    
    print("åµŒå¥—Forå¾ªç¯ç»“æœ: " + total);
    return total;
};

fn test_while_loop_jit(): int {
    print("â° æµ‹è¯•Whileå¾ªç¯JITç¼–è¯‘");
    
    result : int = 0;
    counter : int = 1;
    while (counter <= 50) {
        result = result + counter * 2;
        counter = counter + 1;
    };
    
    print("Whileå¾ªç¯ç»“æœ: " + result);
    return result;
};

fn test_complex_while_loop_jit(): int {
    print("â° æµ‹è¯•å¤æ‚Whileå¾ªç¯JITç¼–è¯‘");
    
    sum : int = 0;
    i : int = 1;
    while (i <= 30) {
        if (i % 3 == 0) {
            sum = sum + i * 5;
        } else {
            if (i % 2 == 0) {
                sum = sum + i * 2;
            } else {
                sum = sum + i;
            };
        };
        i = i + 1;
    };
    
    print("å¤æ‚Whileå¾ªç¯ç»“æœ: " + sum);
    return sum;
};

fn test_loop_unrolling_optimization(): int {
    print("ğŸ”§ æµ‹è¯•å¾ªç¯å±•å¼€ä¼˜åŒ–");
    
    // ç®€å•çš„ç´¯åŠ å¾ªç¯ï¼Œé€‚åˆå±•å¼€
    unroll_sum : int = 0;
    for (i : 1..16) {
        unroll_sum = unroll_sum + i;
    };
    
    print("å¾ªç¯å±•å¼€ä¼˜åŒ–ç»“æœ: " + unroll_sum);
    return unroll_sum;
};

fn test_strength_reduction_optimization(): int {
    print("ğŸ”§ æµ‹è¯•å¼ºåº¦å‰Šå‡ä¼˜åŒ–");
    
    // åŒ…å«ä¹˜æ³•çš„å¾ªç¯ï¼Œé€‚åˆå¼ºåº¦å‰Šå‡
    strength_sum : int = 0;
    for (i : 1..25) {
        strength_sum = strength_sum + i * 8;  // ä¹˜ä»¥8å¯ä»¥ä¼˜åŒ–ä¸ºä½ç§»
    };
    
    print("å¼ºåº¦å‰Šå‡ä¼˜åŒ–ç»“æœ: " + strength_sum);
    return strength_sum;
};

fn test_invariant_hoisting_optimization(): int {
    print("ğŸ”§ æµ‹è¯•å¾ªç¯ä¸å˜é‡æå‡ä¼˜åŒ–");
    
    // åŒ…å«å¾ªç¯ä¸å˜é‡çš„å¾ªç¯
    invariant_sum : int = 0;
    base_value : int = 100;
    multiplier : int = 3;
    
    for (i : 1..20) {
        invariant_sum = invariant_sum + i + base_value * multiplier;  // base_value * multiplieræ˜¯ä¸å˜é‡
    };
    
    print("å¾ªç¯ä¸å˜é‡æå‡ä¼˜åŒ–ç»“æœ: " + invariant_sum);
    return invariant_sum;
};

fn test_mixed_optimization_strategies(): int {
    print("ğŸ”§ æµ‹è¯•æ··åˆä¼˜åŒ–ç­–ç•¥");
    
    mixed_result : int = 0;
    constant : int = 42;
    
    // åŒæ—¶åŒ…å«å¤šç§ä¼˜åŒ–æœºä¼šçš„å¾ªç¯
    for (i : 1..15) {
        if (i % 2 == 0) {
            mixed_result = mixed_result + i * 4 + constant;  // å¼ºåº¦å‰Šå‡ + ä¸å˜é‡æå‡
        } else {
            mixed_result = mixed_result + i + constant;      // ä¸å˜é‡æå‡
        };
    };
    
    print("æ··åˆä¼˜åŒ–ç­–ç•¥ç»“æœ: " + mixed_result);
    return mixed_result;
};

fn test_cache_effectiveness(): int {
    print("ğŸ—„ï¸ æµ‹è¯•JITç¼“å­˜æœ‰æ•ˆæ€§");
    
    cache_total : int = 0;
    
    // é‡å¤æ‰§è¡Œç›¸åŒæ¨¡å¼çš„å¾ªç¯ï¼Œæµ‹è¯•ç¼“å­˜å‘½ä¸­
    for (round : 1..6) {
        pattern_sum : int = 0;
        for (i : 1..12) {
            pattern_sum = pattern_sum + i * 3;
        };
        cache_total = cache_total + pattern_sum;
        print("ç¬¬" + round + "è½®ç¼“å­˜æµ‹è¯•: " + pattern_sum);
    };
    
    return cache_total;
};

fn test_performance_regression(): int {
    print("ğŸ“ˆ æµ‹è¯•æ€§èƒ½å›å½’");
    
    // æ‰§è¡Œä¸€ç³»åˆ—å·²çŸ¥çš„å¾ªç¯æ¨¡å¼ï¼Œç¡®ä¿æ€§èƒ½æ²¡æœ‰é€€åŒ–
    regression_sum : int = 0;
    
    // æµ‹è¯•1: ç®€å•ç´¯åŠ 
    for (i : 1..50) {
        regression_sum = regression_sum + i;
    };
    
    // æµ‹è¯•2: å¹³æ–¹å’Œ
    for (j : 1..20) {
        regression_sum = regression_sum + j * j;
    };
    
    // æµ‹è¯•3: æ¡ä»¶ç´¯åŠ 
    for (k : 1..30) {
        if (k % 2 == 0) {
            regression_sum = regression_sum + k;
        };
    };
    
    print("æ€§èƒ½å›å½’æµ‹è¯•ç»“æœ: " + regression_sum);
    return regression_sum;
};

fn test_edge_cases(): int {
    print("ğŸ” æµ‹è¯•è¾¹ç•Œæƒ…å†µ");
    
    edge_result : int = 0;
    
    // æµ‹è¯•1: å•æ¬¡è¿­ä»£å¾ªç¯
    for (i : 1..2) {
        edge_result = edge_result + i;
    };
    
    // æµ‹è¯•2: ç©ºå¾ªç¯ä½“ï¼ˆåªæœ‰è®¡æ•°å™¨ï¼‰
    empty_counter : int = 0;
    for (j : 1..10) {
        empty_counter = empty_counter + 1;
    };
    edge_result = edge_result + empty_counter;
    
    // æµ‹è¯•3: å¤§æ­¥é•¿å¾ªç¯
    for (k : 1..20) {
        if (k % 5 == 0) {
            edge_result = edge_result + k;
        };
    };
    
    print("è¾¹ç•Œæƒ…å†µæµ‹è¯•ç»“æœ: " + edge_result);
    return edge_result;
};

fn test_memory_intensive_loops(): int {
    print("ğŸ’¾ æµ‹è¯•å†…å­˜å¯†é›†å‹å¾ªç¯");
    
    memory_result : int = 0;
    
    // æ¨¡æ‹Ÿå†…å­˜è®¿é—®å¯†é›†çš„å¾ªç¯
    for (i : 1..25) {
        temp_value : int = i * 2;
        for (j : 1..5) {
            temp_value = temp_value + j;
        };
        memory_result = memory_result + temp_value;
    };
    
    print("å†…å­˜å¯†é›†å‹å¾ªç¯ç»“æœ: " + memory_result);
    return memory_result;
};

fn main(): int {
    print("=== CodeNothing v0.7.7 å¾ªç¯JITç¼–è¯‘å™¨æµ‹è¯•å¥—ä»¶ ===");
    print("");
    
    // åŸºç¡€åŠŸèƒ½æµ‹è¯•
    result1 : int = test_basic_for_loop_jit();
    result2 : int = test_nested_for_loop_jit();
    result3 : int = test_while_loop_jit();
    result4 : int = test_complex_while_loop_jit();
    print("");
    
    // ä¼˜åŒ–ç­–ç•¥æµ‹è¯•
    result5 : int = test_loop_unrolling_optimization();
    result6 : int = test_strength_reduction_optimization();
    result7 : int = test_invariant_hoisting_optimization();
    result8 : int = test_mixed_optimization_strategies();
    print("");
    
    // ç¼“å­˜å’Œæ€§èƒ½æµ‹è¯•
    result9 : int = test_cache_effectiveness();
    result10 : int = test_performance_regression();
    print("");
    
    // è¾¹ç•Œå’Œç‰¹æ®Šæƒ…å†µæµ‹è¯•
    result11 : int = test_edge_cases();
    result12 : int = test_memory_intensive_loops();
    print("");
    
    total : int = result1 + result2 + result3 + result4 + result5 + result6 + 
                  result7 + result8 + result9 + result10 + result11 + result12;
    
    print("=== æµ‹è¯•å¥—ä»¶æ‰§è¡Œå®Œæˆ ===");
    print("æ€»è®¡ç»“æœ: " + total);
    print("ğŸ‰ æ‰€æœ‰JITç¼–è¯‘å™¨æµ‹è¯•é€šè¿‡ï¼");
    
    return total;
};
