# CodeNothing 更新日志

## [v0.3.2] - 2025-07-23

### 🔧 OOP功能修复和完善

#### 修复问题
- **✅ 构造函数执行** - 修复了构造函数未被调用的问题
- **✅ 字段初始化** - 修复了对象字段初始化逻辑
- **✅ 方法调用框架** - 添加了方法调用的基础架构
- **✅ this关键字支持** - 实现了构造函数中的this.field赋值

#### 当前状态
- ✅ 类定义和解析 - 完全支持
- ✅ 对象创建 - 完全支持
- ✅ 构造函数调用 - 完全支持
- ✅ 构造函数参数传递 - 完全支持
- ✅ 字段访问 - 完全支持
- ✅ 方法调用框架 - 已建立
- ⏳ 方法体执行 - 需要完善this上下文和return语句处理

#### 重大修复
- **✅ 构造函数参数传递** - 完全修复，对象初始化正确工作
- **✅ 方法调用不再崩溃** - 修复了panic问题
- **✅ 基础OOP测试完全通过** - 对象创建、字段访问、多对象测试全部成功

#### 待完善问题
- 方法体中的this.field访问需要正确的上下文
- 方法返回值处理需要完善
- 字符串拼接中的None值处理

---

## [v0.3.1] - 2025-07-23

### 🎉 重大更新：面向对象编程（OOP）支持

#### 新增功能
- **完整的类系统**：支持类定义、对象创建、字段访问
  - 类定义语法：`class ClassName { ... };`
  - 字段定义：`public/private/protected fieldName : Type;`
  - 方法定义：`public fn methodName() : ReturnType { ... };`
  - 构造函数：`constructor(params) { ... };`
  
- **对象操作**：
  - 对象创建：`new ClassName(args)`
  - 字段访问：`obj.field`
  - this关键字：`this.field = value`
  
- **访问控制**：
  - `public` - 公共访问
  - `private` - 私有访问
  - `protected` - 保护访问
  
- **类型系统扩展**：
  - 新增 `Type::Class(String)` 类型
  - 支持自定义类类型声明
  - 完整的类型推断和检查

#### 技术实现
- **AST扩展**：新增 `Class`, `Field`, `Method`, `Constructor`, `Visibility` 等结构体
- **解析器增强**：新增 `class_parser.rs` 模块，支持完整的OOP语法解析
- **解释器核心**：新增 `Value::Object(ObjectInstance)` 类型，支持对象实例化
- **表达式系统**：新增 `ObjectCreation`, `FieldAccess`, `This` 表达式类型
- **语句系统**：新增 `ClassDeclaration`, `FieldAssignment` 语句类型

#### 测试文件
- `test_oop_basic.cn` - 基础OOP功能测试
- `test_oop_advanced.cn` - 高级OOP特性测试  
- `test_oop_complex.cn` - 复杂多类交互测试

#### 当前状态
- ✅ 类定义和解析 - 完全支持
- ✅ 对象创建 - 完全支持
- ✅ 字段访问 - 完全支持
- ⏳ 方法调用 - 待实现
- ⏳ 构造函数执行 - 待实现
- ⏳ 继承系统 - 待实现

这是CodeNothing语言发展史上的一个重要里程碑，标志着从过程式编程向面向对象编程的重大跃进！

### 修复
- 修复：重写了词法分析器，以正确处理浮点数、链式调用（`.`）和多字符运算符。
- 修复：现在可以正确解析 `variable.method()` 形式的链式调用，解决了“期望 ';', 但得到了 '.identifier'”的错误。
- 修复：现在可以正确解析浮点数字面量（如 `0.2`），解决了“期望 ')', 但得到了 '.'”的错误。

---

## [v0.3.0] - 2025-07-22
- 修复：重写了词法分析器，以正确处理浮点数、链式调用（`.`）和多字符运算符。
- 修复：现在可以正确解析 `variable.method()` 形式的链式调用，解决了“期望 ';', 但得到了 '.identifier'”的错误。
- 修复：现在可以正确解析浮点数字面量（如 `0.2`），解决了“期望 ')', 但得到了 '.'”的错误。

## [v0.3.0] - 2025-07-21

### 新增
- **链式调用功能**: 添加了完整的链式调用语法支持，允许在一个表达式中连续调用多个方法
  - 基本语法：`object.method1().method2().method3()`
  - 支持字符串、数组、映射类型的链式调用
  - 完全向后兼容，不影响现有代码
- 部分JIT

#### 字符串方法支持
- `trim()` - 去除首尾空格
- `to_upper()` - 转换为大写
- `to_lower()` - 转换为小写  
- `length()` - 获取字符串长度
- `substring(start, end)` - 截取子字符串

#### 数组方法支持
- `length()` - 获取数组长度
- `push(item)` - 添加元素到数组末尾
- `pop()` - 移除并返回最后一个元素

#### 映射方法支持
- `size()` - 获取映射大小
- `get(key)` - 根据键获取值
- `set(key, value)` - 设置键值对

### 优化
- 改进了表达式求值器的类型检查机制
- 优化了方法调用的错误处理
- 增强了JIT编译器的兼容性

## [v0.2.7] - 2025-07-21
### 新增
- io库的read_line加入了input别名。
- 加入了部分JIT实现，支持int/long/float的加减乘除模和比较运算的JIT加速。
- 新增 --cn-query-jit 参数，可查询本次运行是否使用JIT，并输出详细JIT调用统计信息。

## [v0.2.6] - 2025-07-20

### 新增
- 添加了完整的异常处理机制，支持 try-catch-finally 语法
  - try-catch 语句：捕获和处理异常
    ```
    try {
        // 可能抛出异常的代码
    } catch (exception : Exception) {
        // 异常处理代码
    };
    ```
  - try-catch-finally 语句：确保清理代码总是执行
    ```
    try {
        // 可能抛出异常的代码
    } catch (exception : Exception) {
        // 异常处理代码
    } finally {
        // 总是执行的清理代码
    };
    ```
  - throw 语句：抛出异常
    ```
    throw "异常信息";
    throw someVariable;
    ```
  - 支持嵌套的 try-catch 结构
  - 异常会在函数调用栈中向上传播，直到被捕获
  - 支持异常变量的类型声明（Exception 类型）

### 优化
- 拆分了src\parser\mod.rs与src\interpreter\mod.rs
- 更改了time Library的sleep_seconds与sleep部分逻辑，支持浮点数参数
  - sleep_seconds(0.2) 现在可以正常工作，表示 0.2 秒（200 毫秒）
  - sleep(0.5) 现在可以正常工作，表示 0.5 毫秒
  - 新增 sleep_microseconds() 函数支持微秒级别延时
  - 使用纳秒级别精度，提供更精确的延时控制
- 修复并优化了命名空间前缀调用机制
- 现在 `using ns xxx;` 可以在任意作用域（如函数体、代码块内）使用，并只影响当前作用域及其子作用域的无前缀调用（如 add(...)、reverse(...)），不会影响带前缀调用（如 math::add(...)）。
## [v0.2.5] - 2025-07-16

### 新增
- 添加了const关键字，支持常量定义和使用
- 增加了fs库，支持文件操作
  - 根命名空间函数
    - exists(path) - 判断路径是否存在
    - is_file(path) - 判断是否为文件
    - is_dir(path) - 判断是否为目录
  - 文件操作命名空间 (file::)
    - file::read(path) - 读取文件内容
    - file::read_bytes(path) - 读取文件内容为二进制（返回十六进制字符串）
    - file::write(path, content) - 写入文件
    - file::append(path, content) - 追加内容到文件
    - file::delete(path) - 删除文件
    - file::copy(src, dst) - 复制文件
    - file::rename(old_path, new_path) - 重命名文件
    - file::size(path) - 获取文件大小
  - 目录操作命名空间 (dir::)
    - dir::create(path) - 创建目录
    - dir::delete(path) - 删除目录
    - dir::delete_all(path) - 递归删除目录
    - dir::list(path) - 列出目录内容
    - dir::current() - 获取当前工作目录
  - 路径操作命名空间 (path::)
    - path::join(part1, part2, ...) - 连接路径
    - path::parent(path) - 获取父目录
    - path::filename(path) - 获取文件名
    - path::extension(path) - 获取文件扩展名
    - path::stem(path) - 获取不带扩展名的文件名
    - path::is_absolute(path) - 判断路径是否为绝对路径
- 增加了LICENSE文件。


### 修复
- 修复了常量定义和使用的问题
- 修复了常量在函数内部使用的问题



## [v0.2.4] - 2025-07-16
### 新增
- 添加了json库，支持JSON字符串解析和处理。
 - 解析JSON字符串 (json::parse)
 - 格式化JSON (json::format)
 - 创建JSON对象 (json::create_object)
 - 创建JSON数组 (json::create_array)
 - 从JSON中提取值 (json::get_value)
 - 检查JSON是否有效 (json::is_valid)
 - 合并JSON对象 (json::merge)

### 修复
#### 问题1：JSON字符串解析错误
##### 症状：尝试解析JSON字符串时出现"key must be a string at line 1 column 2"错误。
##### 解决方案：
- 添加了preprocess_json_string函数预处理JSON字符串，处理转义字符问题
- 添加了fix_json_string函数修复常见的JSON格式问题，如为没有引号的键添加引号
- 添加了从HTTP响应中提取JSON部分的功能
- 现在可以正确解析和处理JSON字符串，包括从HTTP响应中提取JSON数据。
#### 问题2：数值类型处理问题
##### 症状：数字字符串被当作普通字符串处理，而不是数值类型。
##### 解决方案：
- 在cn_create_object和cn_create_array函数中增加了数字类型检测
- 尝试将字符串解析为整数或浮点数，如果成功则创建数字类型的JSON值
- 现在数字字符串能够被正确识别为JSON数值类型。
#### 问题3：库命名空间处理问题
##### 症状：解析器中硬编码了特定库的命名空间（如http, std, json），导致无法自动识别新库。
##### 解决方案：
- 移除了表达式解析器中的硬编码命名空间判断
- 改进了解释器中的命名空间函数调用处理逻辑
- 完全移除了特殊处理std命名空间的硬编码逻辑，使用统一的命名空间处理方式
- 现在可以自动识别所有库的命名空间，无需修改源码
- 统一了命名空间函数调用的接口，提高了扩展性

## [v0.2.3] - 2025-07-16

### 新增
- 添加http库，支持HTTP请求和URL编码/解码
- 添加foreach循环语法，支持遍历数组、映射和字符串
  ```
  foreach (item in collection) {
      // 对集合中每个元素执行操作
  };
  ```
- 添加条件表达式（三元运算符）
  ```
  result = condition ? value_if_true : value_if_false;
  ```

### 修复
- 修复了关键性问题
  - 修复了库namespace无法正常使用的问题
  - 修复了命名空间函数调用的解析逻辑
  - 改进了库命名空间管理机制，从库配置文件(library.json)中自动加载命名空间信息
  - 简化了命名空间函数调用方式，无需添加库名前缀，支持多个库共享同一命名空间

#### 优化
- 减少了library.json的强依赖

## [v0.2.2] - 2025-07-15

### 修复
- 修复了`using ns`语法无法工作的问题
- 修复了库定义的namespace错误的问题

### 改进
- 改进了库namespace的注册
- 优化了库

## [v0.2.1] - 2025-07-15

### 错误报告改进
- 现在解释器能够一次性显示所有语法错误，而不是只显示第一个错误后停止
- 重新设计的错误报告系统，更清晰地显示错误信息
- 添加了错误恢复机制，即使存在多个错误也能够尽可能多地检查代码
- 添加了 `--cn-parser` 参数用于显示更详细的解析调试信息
- 错误消息格式统一化，提高可读性

### 健壮性提升
- 改进了错误处理流程，防止因单个错误导致整个解析过程终止
- 添加了跳过错误点的恢复策略，使解析器能够继续处理后续代码
- 优化了内部错误信息收集机制，减少内存占用

## [v0.2.0] - 2025-07-15

### 新增功能

#### 文件导入系统
- 添加了`using file`语法，支持从其他文件导入函数、变量和命名空间
- 实现了嵌套导入支持，允许一个文件通过另一个文件间接导入其他内容
- 添加了循环导入检测机制，防止因循环依赖导致的栈溢出

#### void返回类型
- 添加了`void`返回类型，用于不需要返回值的函数
- 规范化了函数返回行为，void类型函数必须使用不带值的`return;`语句

### 示例文件
- 添加了`examples/import_example.cn`演示基本文件导入功能
- 添加了`examples/nested_import.cn`演示嵌套导入功能
- 添加了`examples/circular_import_test.cn`测试循环导入检测
- 添加了多个工具函数文件，展示模块化代码组织

### 修复
- 修复了解析器在处理多文件项目时的内存泄漏问题
- 修复了命名空间函数调用时的作用域解析错误
- 改进了错误报告系统，现在能更准确地显示导入相关错误的位置和原因
- 修复了在Windows系统上文件路径处理的兼容性问题

### 性能优化
- 优化了文件缓存机制，避免重复加载已导入的文件
- 改进了符号表查找算法，提高了多文件项目的解释速度

## [v0.1.1] - 2025-07-15

### 修复
- 修复了 Linux 系统下无法导入 library 的问题

## [v0.1.0] - 2025-07-14

### 初始版本
- 基本语法支持
- 整数和字符串类型
- 基本算术运算
- 条件语句和循环
- 函数定义和调用
- 命名空间支持 

