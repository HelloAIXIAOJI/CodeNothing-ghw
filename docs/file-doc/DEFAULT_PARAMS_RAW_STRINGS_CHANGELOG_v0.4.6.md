# CodeNothing 默认参数值与原始字符串字面量功能 - v0.4.6（2025-07-26）

## 🚀 重大新功能

### 1. 默认参数值 (Default Parameter Values)

默认参数值允许函数定义中的参数指定一个默认值，当调用函数时没有提供该参数时，将使用该默认值。这极大地提高了函数定义的灵活性和使用便利性。

#### 语法规则

```cn
fn 函数名(参数名 : 参数类型 = 默认值, ...) : 返回类型 {
    // 函数体
}
```

#### 主要特性

- **参数可选性**：可以使函数参数变为可选参数，简化函数调用
- **表达式支持**：默认值可以是常量、变量或复杂表达式
- **提高可读性**：使API更加清晰，减少样板代码
- **与必需参数混合**：可以和必需参数一起使用

#### 示例

```cn
// 简单默认参数
fn greet(name : string = "世界", greeting : string = "你好") : string {
    return `${greeting}，${name}！`;
};

// 使用默认值调用
greet();               // 结果: "你好，世界！"
greet("张三");         // 结果: "你好，张三！"
greet("李四", "您好"); // 结果: "您好，李四！"

// 表达式作为默认值
fn multiply(a : int, b : int = a * 2) : int {
    return a * b;
};

multiply(5);  // 结果: 50，使用 5 * (5*2)
multiply(3, 4); // 结果: 12，使用提供的值
```

### 2. 原始字符串字面量 (Raw String Literals)

原始字符串字面量允许定义一个不处理转义序列的字符串，使特殊字符如反斜杠（`\`）和引号保持字面值。这在处理正则表达式、文件路径等需要大量转义字符的场景下特别有用。

#### 语法规则

```cn
r"原始字符串内容"
```

#### 主要特性

- **无需转义**：字符串中的`\`和其他特殊字符不再需要额外转义
- **简化复杂字符串**：特别适合正则表达式、文件路径等
- **保留字符原义**：例如`\n`、`\t`等序列在原始字符串中保持字面值
- **提高可读性**：减少代码中的转义字符，使代码更加清晰

#### 示例

```cn
// 常规字符串（需要转义）
path1 : string = "C:\\Users\\Documents\\file.txt";

// 原始字符串（无需转义）
path2 : string = r"C:\Users\Documents\file.txt";

// 特殊字符比较
normal : string = "第一行\n第二行\t缩进";  // 特殊字符会被转义
raw : string = r"第一行\n第二行\t缩进";    // 特殊字符保持原样

// 正则表达式（无需双重转义）
regex : string = r"\d+\.\d+";
```

## 🔧 技术实现

### 默认参数值实现

1. **AST扩展**:
   - `Parameter` 结构体增加 `default_value: Option<Expression>` 字段

2. **函数解析器增强**:
   - 检测参数声明后的 `=` 符号
   - 解析默认值表达式
   - 将默认值存储在参数结构中

3. **函数调用处理**:
   - 在调用函数时检查提供的参数数量
   - 如果缺少参数且有默认值，则计算默认值
   - 将计算结果用于函数执行

### 原始字符串字面量实现

1. **AST扩展**:
   - 新增 `RawStringLiteral(String)` 表达式类型

2. **词法分析器增强**:
   - 识别 `r"..."` 格式的字符串
   - 将其解析为特殊的 token 类型

3. **解析器增强**:
   - 识别原始字符串标记
   - 将内容解析为 `RawStringLiteral` 表达式

4. **表达式求值器增强**:
   - 添加对 `RawStringLiteral` 的处理逻辑
   - 在运行时直接使用原始字符串值，无需进一步处理

## 🔄 兼容性

- **完全向后兼容**：这两个新功能不影响现有代码
- **可选使用**：仅在需要时使用，不强制改变现有编码习惯
- **混合使用**：默认参数值可以与普通参数混合使用
- **字符串互操作**：原始字符串和常规字符串可以完全互操作

## 🔮 未来扩展计划

### 默认参数值相关扩展

1. **命名参数**：支持按名称传递参数，进一步提高API灵活性
   ```cn
   fn createPerson(name : string, age : int = 25) : void { ... }
   createPerson(age: 30, name: "张三");  // 按名称传递参数
   ```

2. **剩余参数**：支持收集剩余参数为数组
   ```cn
   fn sum(first : int, ...rest : array<int>) : int { ... }
   ```

### 原始字符串相关扩展

1. **多行原始字符串语法**：专门为多行内容优化的语法
   ```cn
   r"""
   这是一个多行
   原始字符串
   保留所有换行和空格
   """
   ```

2. **原始字符串插值**：结合原始字符串和字符串插值的优势
   ```cn
   r`正则表达式: \d+ 匹配数字 ${number}`
   ```

---

这些功能极大地提高了CodeNothing的表达能力，使代码更加简洁、易读，并降低了常见场景下的开发复杂度。特别是与之前实现的字符串插值结合，使字符串处理更加灵活和强大。 